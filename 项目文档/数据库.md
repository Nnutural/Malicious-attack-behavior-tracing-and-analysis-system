## 数据库构建

### 主机日志表：HostLogs

| id   | result               | content            | create_time        | event_hash | host_name           |
| ---- | -------------------- | ------------------ | ------------------ | ---------- | ------------------- |
|      | 主机日志处理后的结果 | 主机日志(完整原文) | 主机日志获取的时间 | 去重hash   | 主机名/ComputerName |

- result/content 均为 NVARCHAR(MAX)

- **加了一个 event_hash VARCHAR(64) NULL ** 字段用于去重

	* 直接在SQL server上加就行

- 并加了唯一索引：（下面代码在加字段后执行）

	* ```sql
		CREATE UNIQUE INDEX UX_HostLogs_event_hash
		ON dbo.HostLogs(event_hash)
		WHERE event_hash IS NOT NULL;
		```

- **加了一个主机名的字段：host_name nvarchar(255)**

	* ```sql
		ALTER TABLE dbo.HostLogs
		ADD host_name NVARCHAR(255) NULL;
		
		CREATE INDEX IX_HostLogs_host_name
		ON dbo.HostLogs(host_name);
		```

		

### 主机行为表：HostBehaviors

| id  | result     | content | create_time |
| --- | ---------- | ------- | ----------- |
|     | 主机行为处理后的结果 | 主机行为内容  | 主机行为获取的时间   |

更新一下主机行为表：

| 字段名         | 类型                                      | 说明                                                         |
| -------------- | ----------------------------------------- | ------------------------------------------------------------ |
| id             | INT IDENTITY(1,1) PRIMARY KEY             | 主键                                                         |
| result         | NVARCHAR(MAX) NOT NULL                    | 主机行为处理后的结果（标准化事件 dict JSON 字符串，接口文档 `host_behavior` schema） |
| content        | NVARCHAR(MAX) NULL                        | 原始行为内容（Linux: Falco 原始 JSON 行；Windows: Sysmon XML / raw_data） |
| create_time    | DATETIME2 NOT NULL DEFAULT(sysdatetime()) | 入库时间                                                     |
| event_hash     | VARCHAR(64) NULL                          | 去重用哈希（sha256(result_sorted_json)）                     |
| host_name      | NVARCHAR(255) NULL                        | 主机名（Windows ComputerName / Linux hostname，可用于筛选）  |
| event_time_utc | DATETIME2 NULL                            | 从 result.timestamp 解析出来的 UTC 时间（用于时间线/窗口查询） |



### 网络流量表：NetworkTraffic

| id  | result     | content   | create_time |
| --- | ---------- | --------- | ----------- |
|     | 网络流量处理后的结果 | 捕获网络流量的内容 | 网络流量获取的时间   |

这里的主机日志、主机行为内容、捕获网络流量的内容应该都是具体捕获到的字符串信息，三个表的处理结果都是字符串，但内容都是字典，就是“日志、行为、流量收集的接口文档.md”需要的三种接口里面的字典
